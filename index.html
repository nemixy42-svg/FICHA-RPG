<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha RPG - Level Up/Down Autom√°tico</title>
    <style>
        :root {
            --bg: #0d1117; --card: #161b22; --primary: #58a6ff; --text: #c9d1d9; --accent: #238636; --border: #30363d; --save: #1f6feb;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; display: flex; justify-content: center; }
        .wrapper { width: 100%; max-width: 800px; background: var(--card); border-radius: 12px; padding: 25px; box-shadow: 0 8px 32px rgba(0,0,0,0.5); border: 1px solid var(--border); }
        h2 { text-align: center; color: var(--primary); margin: 10px 0 25px; text-transform: uppercase; letter-spacing: 3px; font-size: 1.8em; }
        
        .field-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.75em; color: #8b949e; margin-bottom: 5px; font-weight: bold; text-transform: uppercase; }
        input, select, textarea { width: 100%; padding: 10px; background: #010409; border: 1px solid var(--border); color: white; border-radius: 6px; box-sizing: border-box; font-size: 1em; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; margin: 15px 0; }
        .stat-box { background: #0d1117; padding: 12px; border-radius: 10px; border: 1px solid var(--border); text-align: center; }
        .stat-box.total { border-bottom: 4px solid var(--accent); }
        .stat-num { font-size: 1.5em; font-weight: bold; display: block; color: #fff; }
        .stat-label { font-size: 0.6em; color: #8b949e; text-transform: uppercase; }

        .xp-section { background: #0d1117; padding: 15px; border-radius: 10px; border: 1px solid #30363d; margin-bottom: 20px; }
        .xp-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .lvl-badge { background: var(--primary); color: #000; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 1.1em; }
        .xp-input-style { font-size: 1.2em !important; border-color: var(--primary) !important; text-align: center; }

        .equip-list { display: flex; flex-direction: column; gap: 15px; }
        .equip-card { background: #0d1117; border: 1px solid var(--border); border-radius: 10px; padding: 12px; }
        .equip-header { display: grid; grid-template-columns: 3fr 1fr 1fr 1fr; gap: 8px; margin-bottom: 8px; }
        .equip-header input { padding: 8px; font-size: 0.9em; text-align: center; }
        .equip-effect { font-size: 0.85em; background: #161b22 !important; border: 1px dashed #444 !important; color: #aaa; }

        .xp-bar-container { background: #30363d; height: 12px; border-radius: 6px; margin-top: 10px; overflow: hidden; }
        .xp-bar-fill { background: linear-gradient(90deg, #238636, #2ea043); height: 100%; width: 0%; transition: width 0.5s; }
        .xp-instructions { font-size: 0.7em; color: #8b949e; margin-top: 5px; font-style: italic; }

        .section-title { border-left: 4px solid var(--primary); padding-left: 10px; margin: 30px 0 10px; color: var(--primary); font-size: 0.9em; font-weight: bold; text-transform: uppercase; }
        .skill-card { background: #0d1117; padding: 12px; border-radius: 8px; margin-top: 8px; border: 1px solid var(--border); border-left: 4px solid var(--primary); }
        .skill-name { font-weight: bold; color: var(--primary); font-size: 0.95em; }
        .skill-desc { font-size: 0.85em; color: #8b949e; margin-top: 5px; }
        .skill-lvl { float: right; font-size: 0.7em; background: #21262d; padding: 2px 6px; border-radius: 4px; color: var(--primary); }

        .btn-reset { background: #f85149; color: white; border: none; padding: 12px; width: 100%; border-radius: 8px; cursor: pointer; margin-top: 25px; font-weight: bold; opacity: 0.8; }
        .backup-btns { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .btn-backup { background: var(--save); color: white; border: none; padding: 10px; border-radius: 6px; font-weight: bold; cursor: pointer; }
    </style>
</head>
<body>

<div class="wrapper">
    <h2>üõ°Ô∏è FICHA DE BATALHA</h2>

    <div class="backup-btns">
        <button class="btn-backup" onclick="exportarFicha()">üì• BAIXAR PERSONAGEM</button>
        <button class="btn-backup" style="background: var(--accent)" onclick="document.getElementById('file-input').click()">üì§ CARREGAR ARQUIVO</button>
        <input type="file" id="file-input" style="display:none" accept=".json" onchange="importarFicha(event)">
    </div>

    <div class="field-group">
        <label>üåÄ Nome do Participante</label>
        <input type="text" id="part-name" placeholder="Digite seu nome..." oninput="salvar()">
    </div>

    <div class="field-group">
        <label>üòé Classe do Personagem</label>
        <select id="char-select" onchange="salvar()">
            <option value="DRUZION">DRUZION (Curandeiro)</option>
            <option value="GUILBERT">GUILBERT (Arqueiro)</option>
            <option value="MELKYOR">MELKYOR (Mago)</option>
            <option value="SCAR">SCAR (Guerreiro)</option>
            <option value="DEWPEE">DEWPEE (Pistoleiro)</option>
        </select>
    </div>

    <!-- SE√á√ÉO DE XP E N√çVEL AUTOM√ÅTICO -->
    <div class="xp-section">
        <div class="xp-header">
            <label>üî∫ N√≠vel Atual</label>
            <div class="lvl-badge" id="lvl-display">1</div>
        </div>
        <label>‚ú® Gerenciar Experi√™ncia (XP)</label>
        <input type="number" id="xp" value="0" class="xp-input-style" oninput="processarXP()">
        <div class="xp-instructions">Digite valores altos para upar ou negativos para reduzir o n√≠vel.</div>
        
        <div class="xp-bar-container"><div class="xp-bar-fill" id="xp-fill"></div></div>
        <div style="display:flex; justify-content: space-between; font-size: 0.75em; margin-top: 5px;">
            <span>XP Atual: <b id="xp-status">0</b></span>
            <span>Pr√≥ximo N√≠vel: <b id="xp-max">500</b></span>
        </div>
    </div>

    <div class="section-title">üìä Atributos Totais</div>
    <div class="stats-grid">
        <div class="stat-box total">
            <span class="stat-label">üíñ Vida Total</span>
            <span class="stat-num" id="total-hp">0</span>
        </div>
        <div class="stat-box total">
            <span class="stat-label">üëäüèΩ Dano Total</span>
            <span class="stat-num" id="total-dmg">0</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">üõ°Ô∏è Escudo</span>
            <span class="stat-num" id="total-shd">0</span>
        </div>
        <div class="stat-box">
            <span class="stat-label">üí∞ Ouro</span>
            <input type="number" id="ouro" value="0" style="background:transparent; border:none; color:white; font-size:1.2em; font-weight:bold; text-align:center;" oninput="salvar()">
        </div>
        <div class="stat-box">
            <span class="stat-label">üíé Diamantes</span>
            <input type="number" id="diamante" value="0" style="background:transparent; border:none; color:#00ffcc; font-size:1.2em; font-weight:bold; text-align:center;" oninput="salvar()">
        </div>
    </div>

    <div class="section-title">üî∂ Equipamentos Ativos</div>
    <div class="equip-list" id="equip-container"></div>

    <div class="section-title">üéí Mochila</div>
    <textarea id="mochila" placeholder="Itens guardados..." oninput="salvar()" style="min-height: 80px;"></textarea>

    <div class="section-title">üí´ Habilidades</div>
    <div id="skills-container"></div>

    <button class="btn-reset" onclick="resetar()">‚ö†Ô∏è APAGAR FICHA (RESET)</button>
</div>

<script>
    const data = {
        chars: {
            DRUZION: { hp: 90, dmg: 4, p: "AURA VERDE", pd: "Cura: recupera vida do aliado igual ao seu dano total." },
            GUILBERT: { hp: 80, dmg: 8, p: "RESPEITO", pd: "Com 2 aliados ou menos, voc√™ n√£o pode ser alvo." },
            MELKYOR: { hp: 70, dmg: 12, p: "MANAMUNDO", pd: "Causa +10% de dano para cada aliado na batalha." },
            SCAR: { hp: 60, dmg: 16, p: "CONTRAGOLPE", pd: "Dano par recebido causa 20% de volta ao atacante." },
            DEWPEE: { hp: 50, dmg: 20, p: "MUNI√á√ÉO EXPLOSIVA", pd: "Causa 20% do dano a todos os aliados do oponente." }
        },
        skills: [
            { lvl: 1, DRUZION: "REPOUSO / ALVO", GUILBERT: "CHUVA DE FLECHAS", MELKYOR: "VENENO M√ÅGICO", SCAR: "L√ÇMINA VAMP√çRICA", DEWPEE: "RECARREGAR" },
            { lvl: 4, DRUZION: "CURA FRACA", GUILBERT: "PRISMA ARCANO", MELKYOR: "RECARGA DE ENERGIA", SCAR: "UNI√ÉO AMISTOSA", DEWPEE: "TIRO DUPLO" },
            { lvl: 7, DRUZION: "CONFUS√ÉO", GUILBERT: "GRITO DE GUERRA", MELKYOR: "CORROS√ÉO E DRENAGEM", SCAR: "MALDI√á√ÉO", DEWPEE: "BALA DE PRECIS√ÉO" },
            { lvl: 10, DRUZION: "DUETO", GUILBERT: "L√ÇMINA GIRAT√ìRIA", MELKYOR: "DUALIDADE", SCAR: "ARCO-√çRIS", DEWPEE: "RAJADA FREN√âTICA" }
            // O sistema aceita mais habilidades aqui...
        ]
    };

    let nivelGlobal = 1;

    // Criar slots de equipamentos
    const equipContainer = document.getElementById('equip-container');
    for(let i=1; i<=4; i++) {
        equipContainer.innerHTML += `
            <div class="equip-card">
                <div class="equip-header">
                    <input type="text" id="eq_n_${i}" placeholder="Equipamento ${i}" oninput="salvar()">
                    <input type="number" id="eq_h_${i}" placeholder="+HP" oninput="salvar()">
                    <input type="number" id="eq_d_${i}" placeholder="+DMG" oninput="salvar()">
                    <input type="number" id="eq_s_${i}" placeholder="+ESC" oninput="salvar()">
                </div>
                <input type="text" class="equip-effect" id="eq_e_${i}" placeholder="Efeito do item..." oninput="salvar()">
            </div>`;
    }

    // === L√ìGICA DE XP CUMULATIVO (UP E DOWN) ===
    function processarXP() {
        let xp = parseInt(document.getElementById('xp').value) || 0;
        
        // Se XP for maior que o necess√°rio para o n√≠vel atual, sobe
        while (xp >= (nivelGlobal * 500)) {
            xp -= (nivelGlobal * 500);
            nivelGlobal++;
        }

        // Se XP for menor que 0, desce n√≠vel (se n√£o for lvl 1)
        while (xp < 0 && nivelGlobal > 1) {
            nivelGlobal--;
            xp += (nivelGlobal * 500);
        }

        // Trava no n√≠vel 1 com 0 XP
        if (nivelGlobal === 1 && xp < 0) xp = 0;

        document.getElementById('xp').value = xp;
        document.getElementById('lvl-display').innerText = nivelGlobal;
        salvar();
    }

    function salvar() {
        const estado = {
            part: document.getElementById('part-name').value,
            char: document.getElementById('char-select').value,
            lvl: nivelGlobal,
            xp: parseInt(document.getElementById('xp').value) || 0,
            ouro: document.getElementById('ouro').value,
            diamante: document.getElementById('diamante').value,
            mochila: document.getElementById('mochila').value,
            equips: []
        };
        for(let i=1; i<=4; i++) {
            estado.equips.push({
                n: document.getElementById(`eq_n_${i}`).value,
                h: parseInt(document.getElementById(`eq_h_${i}`).value) || 0,
                d: parseInt(document.getElementById(`eq_d_${i}`).value) || 0,
                s: parseInt(document.getElementById(`eq_s_${i}`).value) || 0,
                e: document.getElementById(`eq_e_${i}`).value
            });
        }
        localStorage.setItem('ficha_rpg_vAuto', JSON.stringify(estado));
        atualizarUI(estado);
    }

    function atualizarUI(s) {
        const charBase = data.chars[s.char];
        let bH = 0, bD = 0, bS = 0;
        s.equips.forEach(e => { bH += e.h; bD += e.d; bS += e.s; });

        document.getElementById('total-hp').innerText = charBase.hp + bH;
        document.getElementById('total-dmg').innerText = charBase.dmg + bD;
        document.getElementById('total-shd').innerText = bS;

        const cap = s.lvl * 500;
        document.getElementById('xp-status').innerText = s.xp;
        document.getElementById('xp-max').innerText = cap;
        document.getElementById('xp-fill').style.width = Math.min((s.xp / cap) * 100, 100) + "%";

        const container = document.getElementById('skills-container');
        container.innerHTML = `<div class="skill-card" style="border-left-color: #f1e05a"><span class="skill-name">‚ú® PASSIVA: ${charBase.p}</span><div class="skill-desc">${charBase.pd}</div></div>`;
        
        data.skills.forEach(sk => {
            if(s.lvl >= sk.lvl) {
                container.innerHTML += `<div class="skill-card"><span class="skill-lvl">Lvl ${sk.lvl}+</span><span class="skill-name">‚öîÔ∏è ${sk[s.char]}</span><div class="skill-desc">Habilidade desbloqueada.</div></div>`;
            }
        });
    }

    // Fun√ß√µes de arquivo
    function exportarFicha() {
        const estado = JSON.parse(localStorage.getItem('ficha_rpg_vAuto'));
        const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(estado, null, 2));
        const dl = document.createElement('a');
        dl.setAttribute("href", dataStr);
        dl.setAttribute("download", `ficha_${estado.part || 'personagem'}.json`);
        dl.click();
    }

    function importarFicha(event) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const s = JSON.parse(e.target.result);
            nivelGlobal = s.lvl || 1;
            aplicarEstado(s);
            salvar();
        };
        reader.readAsText(event.target.files[0]);
    }

    function aplicarEstado(s) {
        document.getElementById('part-name').value = s.part || "";
        document.getElementById('char-select').value = s.char || "DRUZION";
        nivelGlobal = s.lvl || 1;
        document.getElementById('lvl-display').innerText = nivelGlobal;
        document.getElementById('xp').value = s.xp || 0;
        document.getElementById('ouro').value = s.ouro || 0;
        document.getElementById('diamante').value = s.diamante || 0;
        document.getElementById('mochila').value = s.mochila || "";
        s.equips.forEach((e, i) => {
            document.getElementById(`eq_n_${i+1}`).value = e.n || "";
            document.getElementById(`eq_h_${i+1}`).value = e.h || 0;
            document.getElementById(`eq_d_${i+1}`).value = e.d || 0;
            document.getElementById(`eq_s_${i+1}`).value = e.s || 0;
            document.getElementById(`eq_e_${i+1}`).value = e.e || "";
        });
        atualizarUI(s);
    }

    function carregar() {
        const salvo = localStorage.getItem('ficha_rpg_vAuto');
        if(salvo) aplicarEstado(JSON.parse(salvo));
        else salvar();
    }

    function resetar() { if(confirm("Apagar tudo?")) { localStorage.removeItem('ficha_rpg_vAuto'); location.reload(); } }
    window.onload = carregar;
</script>
</body>
</html>
